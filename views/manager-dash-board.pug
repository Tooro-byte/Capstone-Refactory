extends layout

block content
  .dashboard-wrapper
    //- Sidebar
    .sidebar
      .sidebar-header
        .logo-container
          .logo-icon üê•
          .logo-text Young4Chicks Manager
        .user-profile
          .avatar
            img(src="/images/manager-avatar.png", alt="Manager Avatar")
          .user-info
            .user-name= currentManager ? currentManager.name : 'Manager'
            .user-type Brooder Manager
            .user-status.online ‚óè Online

      .sidebar-nav
        .nav-section
          .section-title Dashboard
          ul.nav-list
            li.nav-item.active
              a.nav-link(href="/managerDashboard")
                .nav-icon üìä
                span Overview
            li.nav-item
              a.nav-link(href="/manager/profile")
                .nav-icon üë§
                span My Profile

        .nav-section
          .section-title Stock Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/stock")
                .nav-icon üì¶
                span Chick Inventory
                .badge.highlight LIVE
            li.nav-item
              a.nav-link(href="/addchicks")
                .nav-icon ‚ûï
                span Add New Stock
            li.nav-item
              a.nav-link(href="/chickslist")
                .nav-icon üîÑ
                span Update Stock
            li.nav-item
              a.nav-link(href="/chickslist")
                .nav-icon üìã
                span Stock History

        .nav-section
          .section-title Request Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/requests/pending")
                .nav-icon ‚è≥
                span Pending Requests
            li.nav-item
              a.nav-link(href="/manager/requests/approved")
                .nav-icon ‚úÖ
                span Approved Requests
            li.nav-item
              a.nav-link(href="/manager/requests/dispatched")
                .nav-icon üöö
                span Dispatched Requests
            li.nav-item
              a.nav-link(href="/manager/requests/all")
                .nav-icon üìä
                span All Requests

        .nav-section
          .section-title Farmer Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/farmers")
                .nav-icon üë•
                span Active Farmers
            li.nav-item
              a.nav-link(href="/userlist")
                .nav-icon üìà
                span Farmer History
            li.nav-item
              a.nav-link(href="/manager/reports")
                .nav-icon üìä
                span Reports & Analytics

        .nav-section
          .section-title System
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/settings")
                .nav-icon ‚öôÔ∏è
                span Settings
            li.nav-item
              a.nav-link(href="/manager/notifications")
                .nav-icon üîî
                span Notifications

      .sidebar-footer
        .system-status
          .status-indicator.online
          .status-text System Online
          .last-update Last updated: 2 min ago
        .logout-btn
          a(href="/logout")
            .logout-icon üö™
            span Logout

    //- Main Content
    .main-content
      .top-header
        .header-left
          .breadcrumb
            span Manager Dashboard
            .breadcrumb-separator /
            span Overview
          .page-title= `Welcome Back, ${currentManager ? currentManager.name : 'Manager'}! üëã`
          .page-subtitle Manage your brooder operations efficiently

        .header-right
          .header-actions
            .notification-bell
              .bell-icon üîî
            .search-box
              input(type="text", placeholder="Search farmers, requests...")
              .search-icon üîç
            .quick-actions
              a.quick-btn.primary(href="/addchicks")
                .btn-icon ‚ûï
                span Add Stock
              a.quick-btn.secondary(href="/manager/requests/pending")
                .btn-icon üìã
                span Review Requests

      .dashboard-content
        .stats-grid
          .stat-card.primary
            .stat-icon üê£
            .stat-content
              .stat-number= totalStock ? totalStock.totalChicks : 0
              .stat-label Total Chicks in Stock
              .stat-trend= totalStock && totalStock.totalChicks > 100 ? "Good inventory level" : "Low inventory - Restock needed"
          .stat-card.warning
            .stat-icon ‚è≥
            .stat-content
              .stat-number= pendingRequests
              .stat-label Pending Requests
              .stat-trend= pendingRequests > 0 ? `${pendingRequests} requests awaiting approval` : "All caught up"
          .stat-card.success
            .stat-icon ‚úÖ
            .stat-content
              .stat-number= approvedRequests
              .stat-label Approved Today
              .stat-trend= approvedRequests > 0 ? `${approvedRequests} approvals completed` : "No approvals today"
          .stat-card.info
            .stat-icon üë•
            .stat-content
              .stat-number= totalNumOfFarmers
              .stat-label Active Farmers
              .stat-trend= totalNumOfFarmers > 10 ? "Growing community" : "Building farmer network"
          .stat-card.revenue
            .stat-icon üí∞
            .stat-content
              .stat-number= chickSales ? `$${chickSales.totalChickSales || 0}` : "$0"
              .stat-label Total Revenue
              .stat-trend= chickSales && chickSales.totalChickSales > 0 ? `${chickSales.totalNumChicks || 0} chicks sold` : "Start earning today"

        .dashboard-grid
          .dashboard-card.stock-overview
            .card-header
              .card-title
                .title-icon üì¶
                span Current Stock Overview
              .card-actions
                a.btn-small(href="/chickslist") Manage Stock
            .card-content
              .stock-grid
                if stock && stock.length > 0
                  each item in stock
                    .stock-item
                      .stock-info
                        .stock-type= `${item.category} - ${item.type}`
                        .stock-age= `Age: ${item.age} days | Quantity: ${item.number}`
                        .stock-date= `Added: ${item.stock_date ? new Date(item.stock_date).toLocaleDateString() : 'N/A'}`
                else
                  .stock-item
                    .stock-info
                      .stock-type No stock data available
                      .stock-age Add stock to get started

          .dashboard-card.pending-requests
            .card-header
              .card-title
                .title-icon ‚è≥
                span Pending Approval Requests
              .card-actions
                a.view-all(href="/manager/requests/pending") View All
            .card-content
              if requests && requests.length > 0
                each request in requests.slice(0, 5)
                  if request.status === 'pending' || request.status === 'Pending'
                    .request-item
                      .request-info
                        .request-details= `${request.user ? request.user.name : 'Unknown'} - ${request.numChicks} ${request.chickType} chicks`
                        .request-date= `Requested: ${new Date(request.requestDate).toLocaleDateString()}`
                        .request-cost= `Cost: $${request.totalCost || 0}`
              else
                .request-item
                  .request-info
                    .request-details No pending requests
                    .request-date All requests processed

          .dashboard-card.quick-actions-card
            .card-header
              .card-title
                .title-icon ‚ö°
                span Quick Actions
            .card-content
              .action-grid
                .action-item
                  .action-icon üì¶
                  .action-title Add New Stock
                  .action-desc Record new chick arrivals
                  a.action-btn(href="/addchicks") Add Stock
                .action-item
                  .action-icon üîÑ
                  .action-title Update Stock
                  .action-desc Modify existing inventory
                  a.action-btn(href="/updatechick") Update
                .action-item
                  .action-icon üìä
                  .action-title Generate Report
                  .action-desc Create inventory reports
                  a.action-btn(href="/manager/reports") Generate

          .dashboard-card.activities-card
            .card-header
              .card-title
                .title-icon üìã
                span Recent Activities
            .card-content
              if requests && requests.length > 0
                each request in requests.slice(0, 3)
                  .activity-item
                    .activity-content
                      .activity-text= `${request.user ? request.user.name : 'Unknown'} requested ${request.numChicks} ${request.chickType} chicks - ${request.status}`
                      .activity-time= new Date(request.requestDate).toLocaleDateString()
              else
                .activity-item
                  .activity-content
                    .activity-text No recent activities
                    .activity-time Start managing to see activities

          .dashboard-card.alerts-card
            .card-header
              .card-title
                .title-icon ‚ö†Ô∏è
                span Stock Alerts
            .card-content
              if stock && stock.length > 0
                - var lowStockItems = stock.filter(item => item.number < 50)
                if lowStockItems.length > 0
                  each item in lowStockItems
                    .alert-item.warning
                      .alert-icon ‚ö†Ô∏è
                      .alert-content
                        .alert-title Low Stock Alert
                        .alert-desc= `${item.type} stock is low (${item.number} remaining)`
                else
                  .alert-item.info
                    .alert-icon ‚úÖ
                    .alert-content
                      .alert-title All Good!
                      .alert-desc No stock alerts at this time
              else
                .alert-item.warning
                  .alert-icon ‚ö†Ô∏è
                  .alert-content
                    .alert-title No Stock Data
                    .alert-desc Please add stock to monitor levels

          .dashboard-card.chart-card
            .card-header
              .card-title
                .title-icon üìà
                span Monthly Performance
              .chart-period
                select.period-select
                  option Last 6 Months
                  option Last Year
            .card-content
              .chart-container
                .chart-stats
                  .stat-item
                    .stat-value= chickSales ? chickSales.totalNumChicks || 0 : 0
                    .stat-label Total Chicks Sold
                  .stat-item
                    .stat-value= chickSales ? `$${chickSales.totalChickSales || 0}` : "$0"
                    .stat-label Total Revenue
                  .stat-item
                    .stat-value= approvedRequests + dispatchedRequests
                    .stat-label Completed Orders
                .chart-labels
                  span Aug
                  span Sep
                  span Oct
                  span Nov
                  span Dec
                  span Jan
                .chart-legend
                  .legend-items
                    .legend-color.approvals
                    span Approvals

block append head
  link(rel="stylesheet", href="/Styles/manager-dashboard.css")
  //- script(src="/vanilla-js/manager-dashboard.js")