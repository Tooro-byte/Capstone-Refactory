extends layoutX 

block content
  .dashboard-wrapper
    //- Sidebar
    .sidebar
      .sidebar-header
        .logo-container
          .logo-icon üê•
          .logo-text Young4Chicks Manager
        .user-profile
          .avatar
            img(src="/Images/images.jpg", alt="Manager Avatar")
          .user-info
            .user-name= currentManager ? currentManager.name : 'Manager'
            .user-type Brooder Manager
            .user-status.online ‚óè Online

      .sidebar-nav
        .nav-section
          .section-title Dashboard
          ul.nav-list
            li.nav-item.active
              a.nav-link(href="/managerDashBoard")
                .nav-icon üìä
                span Overview
            li.nav-item
              a.nav-link(href="/manager/profile")
                .nav-icon üë§
                span My Profile

        .nav-section
          .section-title Stock Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/stock")
                .nav-icon üì¶
                span Chick Inventory
                .badge.highlight LIVE
            li.nav-item
              a.nav-link(href="/addchicks")
                .nav-icon ‚ûï
                span Add New Stock
            li.nav-item
              a.nav-link(href="/chickslist")
                .nav-icon üîÑ
                span Update Stock
            li.nav-item
              a.nav-link(href="/chickslist")
                .nav-icon üìã
                span Stock History

        .nav-section
          .section-title Request Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manageRequests")
                .nav-icon ‚è≥
                span Pending Requests
            li.nav-item
              a.nav-link(href="/manager/requests/approved")
                .nav-icon ‚úÖ
                span Approved Requests
            li.nav-item
              a.nav-link(href="/manager/requests/dispatched")
                .nav-icon üöö
                span Dispatched Requests
            li.nav-item
              a.nav-link(href="/manageRequests")
                .nav-icon üìä
                span All Requests
            li.nav-item
              a.nav-link(href="/manager/feeds-requests")
                .nav-icon üåæ
                span Feeds Requests
                if pendingFeedsRequests && pendingFeedsRequests > 0
                 .badge.highlight= pendingFeedsRequests

        .nav-section
          .section-title Farmer Management
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/farmers")
                .nav-icon üë•
                span Active Farmers
            li.nav-item
              a.nav-link(href="/userlist")
                .nav-icon üìà
                span Farmer History
            li.nav-item
              a.nav-link(href="/manager/reports")
                .nav-icon üìä
                span Reports & Analytics

        .nav-section
          .section-title System
          ul.nav-list
            li.nav-item
              a.nav-link(href="/manager/settings")
                .nav-icon ‚öôÔ∏è
                span Settings
            li.nav-item
              a.nav-link(href="/manager/notifications")
                .nav-icon üîî
                span Notifications

      .sidebar-footer
        .system-status
          .status-indicator.online
          .status-text System Online
          .last-update Last updated: 2 min ago

    //- Main Content
    .main-content
      .top-header
        .header-left
          .breadcrumb
            span Manager Dashboard
            .breadcrumb-separator /
            span Overview
          .page-title= `Helloüëã, ${currentManager ? currentManager.name : 'Manager'}!`
          .page-subtitle Manage your brooder operations efficiently

        .header-right
          .header-actions
            .notification-bell
              .bell-icon üîî
            .search-box
              input(type="text", placeholder="Search farmers, requests...")
              .search-icon üîç
            .quick-actions
              a.quick-btn.primary(href="/addchicks")
                .btn-icon ‚ûï
                span Add Stock
              a.quick-btn.secondary(href="/manageRequests")
                .btn-icon üìã
                span Review Requests
              a.quick-btn.logout(href="/logout")
                .btn-icon üö™
                span Logout

      .dashboard-content
        .stats-grid
          .stat-card.primary
            .stat-icon üê£
            .stat-content
              .stat-number= totalStock ? totalStock.totalChicks : 0
              .stat-label Total Chicks in Stock
              .stat-trend= totalStock && totalStock.totalChicks > 100 ? "Good inventory level" : "Low inventory - Restock needed"
          .stat-card.warning
            .stat-icon ‚è≥
            .stat-content
              .stat-number= pendingRequests
              .stat-label Pending Requests
              .stat-trend= pendingRequests > 0 ? `${pendingRequests} requests awaiting approval` : "All caught up"
          .stat-card.success
            .stat-icon ‚úÖ
            .stat-content
              .stat-number= approvedRequests
              .stat-label Approved Today
              .stat-trend= approvedRequests > 0 ? `${approvedRequests} approvals completed` : "No approvals today"
          .stat-card.info
            .stat-icon üë•
            .stat-content
              .stat-number= totalNumOfFarmers
              .stat-label Active Farmers
              .stat-trend= totalNumOfFarmers > 10 ? "Growing community" : "Building farmer network"
          .stat-card.revenue
            .stat-icon üí∞
            .stat-content
              .stat-number= chickSales ? `UGX ${chickSales.totalChickSales || 0}` : "UGX0"
              .stat-label Total Revenue
              .stat-trend= chickSales && chickSales.totalChickSales > 0 ? `${chickSales.totalNumChicks || 0} chicks sold` : "Start earning today"

        .dashboard-grid
          .dashboard-card.stock-overview
            .card-header
              .card-title
                .title-icon üì¶
                span Current Stock Overview
              .card-actions
                a.btn-small(href="/chickslist") Manage Stock
            .card-content
              .stock-grid
                if stock && stock.length > 0
                  each item in stock
                    .stock-item
                      .stock-info
                        .stock-type= `${item.category} - ${item.type}`
                        .stock-age= `Age: ${item.age} days | Quantity: ${item.number}`
                        .stock-date= `Added: ${item.stock_date ? new Date(item.stock_date).toLocaleDateString() : 'N/A'}`
                        if item.number < 50
                          .stock-alert ‚ö†Ô∏è Low Stock
                else
                  .empty-state
                    .empty-icon üì¶
                    .empty-title No stock data available
                    .empty-subtitle Add stock to get started
                    a.btn-primary(href="/addchicks") Add Stock

          .dashboard-card.pending-requests
            .card-header
              .card-title
                .title-icon ‚è≥
                span Pending Approval Requests
              .card-actions
                a.view-all(href="/requests") View All
            .card-content
              - var pendingRequestsList = requests ? requests.filter(req => req.status === 'pending' || req.status === 'Pending') : []
              if pendingRequestsList && pendingRequestsList.length > 0
                each request in pendingRequestsList.slice(0, 5)
                  .request-item(data-request-id=request._id)
                    .request-info
                      .request-details= `${request.user ? request.user.name : 'Unknown'} - ${request.numChicks} ${request.chickType} chicks`
                      .request-date= `Requested: ${new Date(request.requestDate).toLocaleDateString()}`
                      .request-cost= `Cost: UGX ${(request.totalCost || 0).toLocaleString()}`
                    .request-actions
                      a.btn-approve(href=`/requests/${request._id}`) Approve
                      a.btn-reject(href=`/requests/reject/${request._id}`) Reject
              else
                .empty-state
                  .empty-icon ‚úÖ
                  .empty-title No pending requests
                  .empty-subtitle All requests processed

          //- Feeds Requests Overview Card (Static placeholder that will be updated by JavaScript)
          .dashboard-card.feeds-stats-card(style="display: none;")
            .card-header
              .card-title
                .title-icon üåæ
                span Feeds Requests Overview
              .card-actions
                a.btn-small(href="/manager/feeds-requests") Manage Feeds
            .card-content
              .feeds-stats-grid
                .feeds-stat-item
                  .stat-number#feedsPending 0
                  .stat-label Pending
                .feeds-stat-item
                  .stat-number#feedsApproved 0
                  .stat-label Approved
                .feeds-stat-item
                  .stat-number#feedsTotal 0
                  .stat-label Total
                .feeds-stat-item
                  .stat-number#feedsRevenue UGX 0
                  .stat-label Revenue

          .dashboard-card.quick-actions-card
            .card-header
              .card-title
                .title-icon ‚ö°
                span Quick Actions
            .card-content
              .action-grid
                .action-item
                  .action-icon üì¶
                  .action-title Add New Stock
                  .action-desc Record new chick arrivals
                  a.action-btn(href="/addchicks") Add Stock
                .action-item
                  .action-icon üîÑ
                  .action-title Update Stock
                  .action-desc Modify existing inventory
                  a.action-btn(href="/chickslist") Update
                .action-item
                  .action-icon üìä
                  .action-title View All Requests
                  .action-desc Manage farmer requests
                  a.action-btn(href="/requests") View Requests
                .action-item
                  .action-icon üåæ
                  .action-title Manage Feeds
                  .action-desc Handle feed requests
                  a.action-btn(href="/manager/feeds-requests") Feeds Requests

          .dashboard-card.activities-card
            .card-header
              .card-title
                .title-icon üìã
                span Recent Activities
            .card-content
              if requests && requests.length > 0
                each request in requests.slice(0, 5)
                  .activity-item
                    .activity-content
                      .activity-text= `${request.user ? request.user.name : 'Unknown'} requested ${request.numChicks} ${request.chickType} chicks - ${request.status}`
                      .activity-time= new Date(request.requestDate).toLocaleDateString()
                    .activity-status(class=request.status.toLowerCase())= request.status
              else
                .empty-state
                  .empty-icon üìã
                  .empty-title No recent activities
                  .empty-subtitle Start managing to see activities

          .dashboard-card.alerts-card
            .card-header
              .card-title
                .title-icon ‚ö†Ô∏è
                span Stock Alerts
            .card-content
              if stock && stock.length > 0
                - var lowStockItems = stock.filter(item => item.number < 50)
                if lowStockItems.length > 0
                  each item in lowStockItems
                    .alert-item.warning
                      .alert-icon ‚ö†Ô∏è
                      .alert-content
                        .alert-title Low Stock Alert
                        .alert-desc= `${item.type} stock is low (${item.number} remaining)`
                      .alert-action
                        a.btn-small(href="/addchicks") Restock
                else
                  .alert-item.success
                    .alert-icon ‚úÖ
                    .alert-content
                      .alert-title All Good!
                      .alert-desc No stock alerts at this time
              else
                .alert-item.warning
                  .alert-icon ‚ö†Ô∏è
                  .alert-content
                    .alert-title No Stock Data
                    .alert-desc Please add stock to monitor levels
                  .alert-action
                    a.btn-small(href="/addchicks") Add Stock

          .dashboard-card.chart-card
            .card-header
              .card-title
                .title-icon üìà
                span Performance Overview
              .chart-period
                select.period-select
                  option Last 6 Months
                  option Last Year
            .card-content
              .chart-container
                .chart-stats
                  .stat-item
                    .stat-value= chickSales ? chickSales.totalNumChicks || 0 : 0
                    .stat-label Total Chicks Sold
                  .stat-item
                    .stat-value= chickSales ? `UGX ${chickSales.totalChickSales || 0}` : "UGX0"
                    .stat-label Total Revenue
                  .stat-item
                    .stat-value= approvedRequests + dispatchedRequests
                    .stat-label Completed Orders
                .performance-summary
                  .summary-item
                    .summary-label Current Manager:
                    .summary-value= currentManager ? currentManager.name : 'Not Available'
                  .summary-item
                    .summary-label Email:
                    .summary-value= currentManager ? currentManager.email : 'Not Available'
                  .summary-item
                    .summary-label Role:
                    .summary-value= currentManager ? currentManager.role : 'brooderManager'

        .dashboard-footer
          .footer-content
            .last-update Last updated: Never
            button#refresh-btn.refresh-button
              .refresh-icon üîÑ
              span Refresh Dashboard

block append head
  link(rel="stylesheet", href="/Styles/manager-dashboard.css")
  script(src="/vanilla-js/manager-dashboard.js")